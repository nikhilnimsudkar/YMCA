<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>

       
<body>

<%@ include file="../../layouts/include_taglib.jsp"%>
<script src="<%=contextPath %>/resources/js/sha512.js"></script>
<script src="<%=contextPath %>/resources/js/payment/luhn.js"></script>
<script src="<%=contextPath %>/resources/js/payment/view.js"></script>
<script src="<%=contextPath %>/resources/js/jquery.validate.min.js"></script>
<script src="<%=contextPath %>/resources/js/maskedinput.min.js"></script>
<script src="<%=contextPath %>/resources/js/app/payment_new.js"></script>


<script id="terms-conditions-ErrorBox" type="text/x-kendo-template">
    <p class="error-message-p">Please agree the terms and conditions before Proceding</p>
	
    <div class="confirmbutton" align="center"><button class="confirm-terms-conditions k-button" style=" width: 35%;">Ok</button>   
</script>

<%@ include file="../../layouts/include_taglib.jsp" %>
<div id="main">

<div id="content" style="margin-bottom:30px; margin-top: -5px;">
<div class="k-loading-mask" style="width:100%;height:100%; position:absolute; top:114px; left:0px;display:none; z-index:9999">
	<span class="k-loading-text">Loading... Please wait</span>
	<div class="k-loading-image">
		<div class="k-loading-color"></div>
	</div>
</div>
		<div id="contentFormDiv" >
		
		<form:form commandName="signup" class="bootstrap-frm cmxform" id="createDonationForm" method="post" action="donationEmployerMatch" style="padding:20px; max-width: 800px;">
		  
			<div>				 
				  <input type="hidden" id="loggedInAccountId" value="${account.accountId }">
				  <input type="hidden" id="paymentOrderId" name="paymentOrderId" value=""/>
				  <input type="hidden" id="paymentMethodId" name="paymentMethodId" value=""/>
				  <input type="text" name="employeeSignUp" id="employeeSignUpId" value="" style="display : none;">
				  <input type="text" name="employee" id="employeeNameId" value="" style="display : none;">	
				  <input type="hidden" style="position : absolute; left : -1000; top : -1000px;" id="todayKendoDate" name="todayKendoDate" value=""/>
				  			  
				  <h4><span style="float:right;"><span style="color:red">*</span> Required Fields.<br></span></h4>
				  <h3><span>Employer Donation<br /></span></h3>	
				  <table border="0"  width="100%">
				  		<tr>
				  			<td >
				  				<span class="label-header1"><span>List of Employee</span></span>
				  			</td>				  						  				  			
				  		</tr>
				  		<tr>
					  		<td>
					  			<span style="">
							   		<select id="employerMatchingSelect" name="employereee" style="width : 600px; ">
							   			<option value="-1">--Select Employee--</option>
										<c:forEach var="employee" items="${employeeSignupLst}" varStatus="count">
											<option value="${employee.signupId }__${employee.pledgeAmountFrequency }__${employee.signUpPricingOption }__${employee.totalAmount  }__${employee.contact.firstName } ${employee.contact.lastName }">${employee.contact.firstName } ${employee.contact.lastName }; Payment Frequency : ${employee.pledgeAmountFrequency } ${employee.signUpPricingOption }; Total Amount : ${employee.totalAmount  }</option>
										</c:forEach>	
										<option value="0">Other</option>	
									</select>
							   	</span>
					  		</td>					  		
					  	</tr>
					  	<tr>
				  			<td >
				  				<span id="donationEmpMatchErr" style="margin-left : 8px; font-style: italic; color: red; display:none;"></span>
				  			</td>
				  			<td >
				  				&nbsp;
				  			</td>	
				  		</tr>
				  </table>
				   <div id="employerMatchInfoDiv" style="display:none;">
						<div>
							 <table border="0" width="100%" id="employerMatchInfoTable">
								<tr>
									<td><input type="text" maxlength="20" size="15" value="" id="companyName" name="companyName" placeholder="Company name" style="width: 200px;"></td>
									<td >&nbsp;</td>
									<td><input type="text" maxlength="50" size="15" value="" id="companyAddress" name="companyAddress" placeholder="Company Address" style="width: 200px;"></td>
									<td >&nbsp;</td>					 		
								</tr>
								<tr>
									<td><input type="text" placeholder="Company Phone" name="companyPhone" id="companyPhone" value=""  style="width: 200px;"/></td>
									<td >&nbsp;</td>
									<td><input type="text" placeholder="Employer Contact Email address" name="employeeEmailId" id="employeeEmailId" value="" style="width: 200px;"/></td>
									<td >&nbsp;</td>					 		
								</tr>
							</table>
							
						</div>
					</div>
				  
				  <span id="empMatchDetailsSpan" style="display:none;">
					  	<table border="0" class="table-48td" width="100%">
					  		<tr>				  				
					  			<td>
					  				<span class="label-header1">Apply my gift to the following YMCA branch: </span>
					  			</td>	
					  			<td >
					  				<span class="label-header1">Payment Frequency<span style="color:red">*</span></span>
					  			</td>  					  			
					  		</tr>
					  		<tr>
					  			<td >
					  				<select name="specialRequest" id="donationBranch" style="width:200px;" ><br />
										<option value="0">--Select Location--</option>
										<c:forEach var="location" items="${locations}" varStatus="count">
											<c:if test="${ location.recordName != 'All Branches' && location.recordName != 'Bay Area' && location.branch == 'true' && location.recordName == 'El Camino YMCA' }">
												<option value="${location.recordName }" selected="selected">${location.recordName }</option>
											</c:if>
											<c:if test="${ location.recordName != 'All Branches' && location.recordName != 'Bay Area' && location.branch == 'true' && location.recordName != 'El Camino YMCA'}">
												<option value="${location.recordName }">${location.recordName }</option>
											</c:if>
										</c:forEach>	
										<option value="Other">Other Branch</option>					
									</select>				
									<input type="text" placeholder="YMCA Other branch" name="specialRequest" id="YmcaBranchTxt" style="width: 150px; display: none; margin-left : 5px;" />
					  			</td>	
					  			<%-- <td >
						  			<c:if test="${param != null && param.opptyId != null}">
									  <input type="radio" checked="checked" name="signUpPricingOption" class="donationFrequencyStr" value="One Time"> One Time
									</c:if>
									<c:if test="${param != null && param.opptyId == null}">
									  <input type="radio" name="signUpPricingOption" class="donationFrequencyStr" value="One Time"> One Time
									</c:if>
					  				
					  				<input type="radio" name="signUpPricingOption" class="donationFrequencyStr" value="Monthly"> Monthly
					  				<select id="donationFrequencyMonthsSel" name="pledgeAmountFrequency" style="width : 170px; display : none; margin-left : 5px;">
								  		<option value="0">--Select No of Months--</option>				  		
								  		<option>1</option>
								  		<option>2</option>
								  		<option>3</option>
								  		<option>4</option>
								  		<option>5</option>
								  		<option>6</option>
								  		<option>7</option>
								  		<option>8</option>
								  		<option>9</option>
								  		<option>10</option>
								  		<option>11</option>
								  		<option>12</option>
								  		<option selected="selected" value="Continuous">Continuous</option>				  		
								  </select>
								  <span id="donationFreqErr" style="margin-left : 8px; font-style: italic; color: red;display:none; "></span>
					  			</td> --%>
					  			<td>
					  				<table border="0" class="" id="frequencyTable" width="100%">
										<tr>
											<td>Frequency</td>
											<td>
												<select id="billingFrequency" name="signUpPricingOption" style="width :  100%;">
													<c:forEach var="pricingRule" items="${pricingRuleList}" varStatus="count">
															<option value="${pricingRule.priceOption }">${pricingRule.priceOption }</option>
													  </c:forEach>
													  <option value="One Time">One Time</option>					  		
												</select>
											</td>			  			
										</tr>
										<tr>
											<td>Number of Installments</td>
											<td>
												<select id="numberOfInstallments" name="pledgeAmountFrequency" style="width : 100%;">  					  		
												</select>
											</td>			  			
										</tr>
									</table>
					  			</td>						  					  							  			
					  		</tr>				  		
					  </table>	<br />
					  <span id="donationAmtSpanIdr">
					  		<span class="label-header1">Donation Amount<span style="color:red">*</span><br /></span>		
							  <input type="radio" name="finalAmountRadio" value="1500" > $1,500
							  <input type="radio" name="finalAmountRadio" value="500"> $500 
							  <input type="radio" name="finalAmountRadio" value="250"> $250
							  <input type="radio" name="finalAmountRadio" value="50"> $50
							  <c:if test="${param != null && param.opptyId != null}">
							  <input type="radio" name="finalAmountRadio" id="donationAmtOther"  checked="checked" value="Other" > Other: 
							  </c:if>
							  <c:if test="${param != null && param.opptyId == null}">
							  <input type="radio" name="finalAmountRadio" id="donationAmtOther"   value="Other" > Other: 
							  </c:if>
							  <%-- <form:input cssClass="form-control" path="finalAmountRadio" title="Please enter your First Name" name="finalAmountRadio" id="firstName" maxlength="50" placeholder="First Name" value="" /> --%>
							  <input type="text" name="finalAmountRadio" id="donationAmtOtherTxt" style="width: 250px;" onkeypress="return isNumberKey(event)" value="${donationOppty.revenue }">
							  <span id="donationAmtErr" style="margin-left : 8px; font-style: italic; color: red; display:none;"></span>				  
							  <input type="text" name="itemDetailId" id="donationTCItemDetailId" value="${donationTAndC.id }" style="width: 250px;display : none;">
							  
							  <br />
							   
							  <input type="text" style="display:none;" name="finalAmount" id="donationAmtStr" value="${donationOppty.revenue }">
							  <input type="text" style="display:none;" name="donationFrequency" id="donationFreq" value="">
							  	
							  <span id="donationFreqMonthlySelMsgSpan" style="color : blue; display : none;">
							  	<span>Note : i) Your card information will be stored in your profile.</span>&nbsp;&nbsp;&nbsp;
							  	<span id="amtChanrgedNoteSpan"></span>&nbsp;&nbsp;&nbsp;
							  	<span id="amtPledgingNoteSpan"></span>
							  	<br /><br />
							  </span>					  
					  </span>
					  <span>
					  		<span class="label-header1">Start Date : </span> &nbsp;	
					  		<input type="text" placeholder="Donation Date" name="nextBillDate" id="donationDate" value="" style="margin: 0px; width : 240px;" />				  		
					  		<!-- <input type="text" placeholder="Donation Date" name="donationDate" id="donationDate" value="" style="width:220px; margin: 0px; " />	 -->				  		
					  </span><br /><br />
				  	  <span id="recognizedAsSpan">
					   		<span class="label-header1">Recognized as<span style="color:red">*</span> : </span>
					   		<span>				   			
					   			<span><input type="radio"  value="Anonymous" name="recognizeAsRadioInput">&nbsp;<span class="recognizedAsSpanCls">Anonymous</span></span>				   			
					   			<!-- <span><input type="radio"  value="" name="recognizeAsRadioInput" id="recognizedAsName"><span class="recognizedAsSpanCls"><span id="recognisedAsFName"></span>&nbsp;<span id="recognisedAsLName"></span></span></span> -->
					   			<span><input type="radio" value="" name="recognizeAsRadioInput" id="recognizedAsContactName"></span>&nbsp;
					   							   			
					   		</span>&nbsp;&nbsp;		   		
					   		<select id="contactLstSelect"  style="width : 200px;">
					   			<option>--Select Contact--</option>
					   			<c:if test="${pageContext.request.userPrincipal.isAuthenticated()}">
									  <c:forEach var="contact" items="${contactLst}" varStatus="count">
									  		<option value="${contact.contactId }">${contact.firstName }&nbsp;${contact.lastName }</option>
									  </c:forEach>
								</c:if> 
								<option value="2">Other</option>		
							</select>
							<input type="text" placeholder="Contact Name" name="recognizeAsTextName" onkeypress="return contactNameChange(event)" id="recognizeAsOtherTxt" style="width: 100px; display: none; margin-left : 5px;" />					
							<span id="donationContactSelErr" style="margin-left : 8px; font-style: italic; color: red; display:none;"></span>
							<input type="text" id="recognizedAsHidInput" name="recognizeAs" value="" style="display: none;" />	
					   </span><br />
					   <div id="purchase_info1" style="margin-left : 18px;">
							<c:if test="${pageContext.request.userPrincipal.isAuthenticated()}">
								<div style="  margin-left: -18px; margin-bottom: 8px; font-weight: bold;" class="label-header1">
									<label >Payment Method :</label>
								</div>
								<div>
									<select id="paymentInfoRadio" name="paymentInfoRadio" style="width:350px;  margin-left: -18px;">
										
										<c:forEach var="paymentInfo" items="${paymentInfoLst}" varStatus="count">
											<c:choose>
											<c:when test="${ paymentInfo[4] == 'CREDIT' }">
												<option value="${ paymentInfo[4] }__${ paymentInfo[0] }__${ paymentInfo[8] }"> ${ paymentInfo[3] } ${paymentInfo[2] } ${ paymentInfo[5] }/${ paymentInfo[6] } </option>
											</c:when>
											<c:when test="${ paymentInfo[4] == 'ACH' }">
												<option value="${ paymentInfo[4] }__${ paymentInfo[0] }__${ paymentInfo[8] }"> ${ paymentInfo[3] }, ${paymentInfo[2] } </option>
											</c:when>
											</c:choose>								
										</c:forEach>							
										<option value="New">Add New Card</option>		
										<c:if test="${sessionScope.agentUid != null}">
									         <option value="Cash">Cash</option>
									         <option value="Check">Check</option>
									         <option value="None">None</option>
									         <option value="Stock">Stock</option>
								        </c:if>				
									</select>
								</div>
							</c:if>
								
							<div id="addcard" style="margin-top:10px; margin-bottom:10px; height:44px; display:none;">
								  
									
									<div style="height:50px;">
										<div class="addcarddiv">
											<div style="height:20px;">Name on card</div>
											<div><input type="text" style="height:25px;" class="k-textbox" placeholder="Full Name on Card" name="fullName" id="fullName" value="" tabIndex="1" maxlength="50" ></div>
										</div>
										<div class="addcarddiv">
											<div style="height:20px; ">Card Number</div>
											<div>
												<input autocomplete="off" type="text" style="height:25px; width: 130px;" class="k-textbox" placeholder="Card Number" name="cardNum" id="cardNum" value="" tabIndex="2" maxlength="16" onchange="handleCCTyping(this.form, event);" onkeyup="handleCCTyping(this.form, event);">
												<img src="resources/img/payment_credit_cards/cards/invalid.png" name="cardimage" ID="cardimage" width="40"  height="22" align="top">
											</div>
										</div>
										<div class="addcarddiv">
											<div style="height:20px;">Expiration date</div>
											<div>
												<span>
													<select id="addCardExpirationMonthSelect" name="addCardExpirationMonthSelect" style="width:50px;">
									                      <option value="01">01</option>
									                      <option value="02">02</option>
									                      <option value="03">03</option>
									                      <option value="04">04</option>
									                      <option value="05">05</option>
									                      <option value="06">06</option>
									                      <option value="07">07</option>
									                      <option value="08">08</option>
									                      <option value="09">09</option>
									                      <option value="10">10</option>
									                      <option value="11">11</option>
									                      <option value="12">12</option>
													</select>
												</span>
												<span>
													<select id="addCardExpirationYearSelect" name="addCardExpirationYearSelect" style="width:70px;">
													</select>
												</span>										 
											</div>
										</div>
										<div class="addcarddiv">
											<div style="height:20px;">Security Code</div>
											<div><input  autocomplete="off" type="password" style="height:25px;" class="k-textbox" placeholder="Security Code" name="securityCode" id="securityCode" value="" tabIndex="3" maxlength="4"></div>
										</div>
									</div><br />
									
									<div style="height:50px;">
										<div class="addcarddiv">
											<div style="height:20px;">Address Line 1</div>
											<div><!-- <textarea placeholder="Billing AddressLine1" name="billingAddressLine1" id="billingAddressLine1" class="k-textbox" style="width: 279px; height: 46px;"></textarea> -->
												<input type="text" class="k-textbox" style="height:25px;" placeholder="AddressLine1" name="billingAddressLine1" id="billingAddressLine1" value="" tabIndex="4">
											</div> 
										</div>
										<div class="addcarddiv">
											<div style="height:20px;">Address Line 2</div>
											<div><input type="text" class="k-textbox" style="height:25px;" placeholder="AddressLine2" name="billingAddressLine2" id="billingAddressLine2" value="" tabIndex="5"></div> 
										</div>
										<div class="addcarddiv">
											<div style="height:20px;">City</div>
											<div><input type="text" class="k-textbox" style="height:25px;" placeholder="City" name="billingCity" id="billingCity" value="" tabIndex="6"></div> 
										</div>
										<div class="addcarddiv" style="width:45px;">
											<div style="height:20px;">State</div>
											<div><input type="text" class="k-textbox" style="height:25px;" placeholder="State" name="billingState" id="billingState" value="" style="width:45px;" tabIndex="7"></div> 
										</div>
										<div class="addcarddiv" style="width:60px">
											<div style="height:20px;">Zip</div>
											<div><input type="text" class="k-textbox" style="height:25px;" placeholder="ZipCode" name="billingZip" id="billingZip" value="" style="width:60px;" tabIndex="8"></div> 
										</div>
										
									</div><br />
									
									<div style="height:50px;">
										
										<div id="savecardcheckbox" class="addcarddiv" style="width:124px">
											<div><input type="checkbox" class="SaveCard" name="SaveCard" id="SaveCard">&nbsp;&nbsp;Save Card</div>
										</div>
										<div id="nicknamediv" class="addcarddiv" >
											<div style="height:20px;">Nick Name</div>
											<div><input type="text" style="height:25px;" class="k-textbox" placeholder="Nick Name" name="nickName" id="nickName" value="" tabIndex="9"></div> 
										</div>
									</div>
								
							</div>
							<div id="statusBlock-payment" style="display: none; margin-top: 145px;">
								<span class="k-block k-success-colored"	id="tcloginSuccessSpan-payment" style="display: none"></span>
								<span class="k-block k-error-colored" id="tcloginErrorSpan-payment" style="display: none"></span>
							</div>
						</div>
						<c:if test="${donationTAndC != null && donationTAndC.waiversAndTC != null && not empty donationTAndC.waiversAndTC.tcDescription && empty agentUid}">
							<div id="TAndCHoldMembershipDiv" class="termsAndConditionParentDiv" style="width : auto !important;">
								<div class="termsAndConditionContent" style="padding: 25px;">
									
								</div>									
							</div>
							<input type="checkbox" name="chkTermsAndCondition" style="margin-top: 10px;">&nbsp;I accept terms and conditions
							<span style="display : none;" id="commonTAncHidden">${donationTAndC.waiversAndTC.tcDescription }</span>
						</c:if>
						  <div id="statusBlock">
							<span class="k-block k-success-colored" id="addDonationSuccessSpan"></span>
							<span class="k-block k-error-colored" id="addDonationErrorSpan"></span>
						  </div>
							<br />
						  <span id="createDonationButton" class="k-button" style="width: 150px; text-shadow: none;">Donate Now ></span>
						   <div id="form_container" >
					
							</div> 
							<div class="bootstrap-frm" id="paymentSuccessDiv" style="display:none">
								<h2><span>Payment Process Completed Successfully.</span></h2>
							</div>
							<div class="bootstrap-frm" id="paymentFailuresDiv" style="display:none">
								<h2><span>Payment process Failed. Please try after sometime. </span></h2>
							</div>
				  </span>
				<br /><br />				
			</div>
			<div id="PaymentInformationBackLnk" align="right">
	        		<a href="/ymca-web/donationHome">Back to Donation Information</a>
	        </div>	       
		</form:form>
		<iframe src="<%=contextPath %>/viewPaymentForm" height="1px" width="1px" id="childIframeId" style=" position:absolute; bottom:-10px; left:-10px;"></iframe>		
		</div> 
	</div>
</div>

<script>

	$(document).ready(function() {
		var dobYear = new Date().getFullYear();
		dobYear = parseInt(dobYear.toString());
		for(var i=0; i<100 ; i++){
			$('#dobYear').append($('<option>', {value: dobYear,text: dobYear}));
			dobYear = dobYear - 1;
		}
		$("#dobYear").kendoDropDownList();    
		$("#dobDate").kendoDropDownList();
		$("#dobMonth").kendoDropDownList();
		
		for(var i=1; i<=48 ; i++){
			$('#numberOfInstallments').append($('<option>', {value: i,text: i}));			
		}
		$("#numberOfInstallments").kendoDropDownList();
		var numberOfInstallments = $("#numberOfInstallments").data("kendoDropDownList");
		$("#billingFrequency").kendoDropDownList();
		
		var currentYear = new Date().getFullYear();
		currentYear = parseInt(currentYear.toString());
		for(var i=0; i<30 ; i++){
			$('#addCardExpirationYearSelect').append($('<option>', {value: currentYear,text: currentYear}));
			currentYear = currentYear +1;
		}
		$("#addCardExpirationYearSelect").kendoDropDownList();    
	    $("#addCardExpirationMonthSelect").kendoDropDownList();
		
		<c:if test="${pageContext.request.userPrincipal.isAuthenticated()}">		
			$("#donerFirstName").attr("disabled","disabled");
			$("#donerLastName").attr("disabled","disabled");
			$("#email").attr("disabled","disabled");			
		</c:if>
	
		$(".termsAndConditionContent").html($("#commonTAncHidden").html());
		$("#preferredPhone").mask("(999) 999-9999");
		$("#companyPhone").mask("(999) 999-9999");	
		$("#dateOfBirth").kendoDatePicker();
		var currentYear = new Date().getFullYear();
		currentYear = parseInt(currentYear.toString());
		for(var i=0; i<30 ; i++){
			$('#addCardExpirationYear').append($('<option>', {value: currentYear,text: currentYear}));
			currentYear = currentYear +1;
		}
		$('#employerMatchingSelect').kendoDropDownList();		
		var employerMatchingSelect = $("#employerMatchingSelect").data("kendoDropDownList");
		employerMatchingSelect.select(0);
	    
		/* $('#donationFrequencyMonthsSel').kendoDropDownList();
		var donationFrequencyMonthsSel = $("#donationFrequencyMonthsSel").data("kendoDropDownList");
		donationFrequencyMonthsSel.select(0);  */
		
		<c:if test="${param != null && param.opptyId != null}">
			$('#campaignerSelect').kendoDropDownList();
			var campaignerSelect = $("#campaignerSelect").data("kendoDropDownList");
			$('#campaignerSelectOther').attr("value", "");
			if(campaignerSelect.text()=='Other'){					
				$('#campaignerSelectOther').css("display","");
			}else{
				$('#campaignerSelectOther').css("display","none");
			}		
			$(document).on( "change", "#campaignerSelect", function() {
				$('#campaignerSelectOther').attr("value", "");
				if(campaignerSelect.text()=='Other'){					
					$('#campaignerSelectOther').css("display","");
				}else{
					$('#campaignerSelectOther').css("display","none");
				}
			 });
		</c:if>
		
		/* ,
		success: function( data ) {
			console.log(data);
			//return true;
			if(data == true){
				console.log("true");
				return "true";
			}else { 
				console.log("false");
				return "false";
			}								
		} */
		/* 
		var donerFirstName = $(document).find("#donerFirstName").val();
		var donerLastName = $(document).find("#donerLastName").val();
		var dobMonth = $('#dobMonth').val();
		var dobDate = $('#dobDate').val();
		var dobYear = $('#dobYear').val(); */
		
		
		/*Payment Process Credit Card */
		var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
		var eventer = window[eventMethod];
		var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
		eventer(messageEvent,function(e) {
			var key = e.message ? "message" : "data";
			var data = e[key];
			//$("#contentFormDiv").css("display", "none");			
			if(data.view.toString() == "Success"){
				   			      
				    $("#statusBlock-payment").css("display", "none");	
				    $("#tcloginErrorSpan-payment").css("display", "none");	
				    $( "#tcloginErrorSpan-payment" ).html("");
				document.forms["createDonationForm"].submit();				
				$(".k-loading-mask").hide();
				$('#contentFormDiv').unblock(); 
			}
			if(data.view.toString() == "Failure"){
				$('#childIframeId').attr("src", "<%=contextPath %>/viewPaymentForm");				
			        $("#statusBlock-payment").css("display", "block");	
			        $("#tcloginErrorSpan-payment").css("display", "block");	
			        $( "#tcloginErrorSpan-payment" ).html("Error occurred while processing the payment. Please try again later");
			        $(".k-loading-mask").hide();
			        $('#contentFormDiv').unblock(); 
				
			}	
		},false);
		/*Payment Process Credit Card - End*/
		
		var url = "isEmailExistsWithUserData";
		var validator1 = $("#createDonationForm").validate({
			debug: true,
			errorElement: "em",			
			errorPlacement: function(error, element) {
				$element = $(element);			
				//console.log($element.hasClass("dateOfBirth"));
				if($element.attr("id") == "dateOfBirth"){
					$element.parent().parent().parent().next("td").html("");
					element.addClass("inputErrorr");
					error.appendTo(element.parent().parent().parent().next("td"));
					element.parent().parent().parent().next("td").addClass("textMsgError");
					$element.parent().parent().parent().next("td").css("color","red");
				}else{ 
					element.addClass("inputErrorr");
					error.appendTo(element.parent("td").next("td"));
					element.parent("td").next("td").addClass("textMsgError");
					$element.parent("td").next("td").css("color","red");
				}
				//$("#wizard"). smartWizard("fixHeight");
				/* element.addClass("inputErrorr");
				error.appendTo(element.parent("td").next("td"));
				element.parent("td").next("td").addClass("textMsgError"); */
			},
			success: function(label, element) {
				//alert("success");
				//label.text("ok!").addClass("success");
				var $element = $(element);
				var $label = $(label);
		       	$element.removeClass("inputErrorr");
				$element.removeClass("error");
				$element.addClass("success");
				
				$label.removeClass("textMsgError");
				$label.removeClass("error");
				$label.addClass("success");
				//$("#wizard"). smartWizard("fixHeight");
				
			},
			rules: {
				"donerFirstName": {
					required: true,
					minlength: 2,
					maxlength: 20
				},
				"donerLastName": {
					required: true,
					minlength: 2,
					maxlength: 20
				},
				"dateOfBirth" : "required",		
				"preferredPhone" : "required",				
				"addressLine1" : "required",			
				"city" : "required",
				"zipcode" : {
					required: true,
					number: true,
					minlength: 5
				},
				"state" : "required",
				"companyName": "required",
				"companyAddress" : "required",
				"companyPhone" : {
					required: true,
					//number: true,
					minlength: 4
				},
				"employeeEmailId" :  {					
					email: true
				}
				<c:if test="${!pageContext.request.userPrincipal.isAuthenticated()}">
					,"email" :  {
						required: true,
						email: true,
						remote: {
							url: url,  
							type:"GET",
							data: {
								  donerFirstName: function() {
						            return $(document).find("#donerFirstName").val();
						          },
						          donerLastName: function() {
							            return $(document).find("#donerLastName").val();
							      },
							      dobMonth: function() {
						            return $('#dobMonth').val();
						          },
						          dobDate: function() {
						            return $('#dobDate').val();
						          },
						          dobYear: function() {
						            return $('#dobYear').val();
						          }					
						    }
						}
					}
				</c:if>
				<c:if test="${pageContext.request.userPrincipal.isAuthenticated()}">
				,"email" :  {
					required: true,
					email: true
				}
			</c:if>
				
				
			},
			messages: {
				"donerFirstName": {				
					required: "Please enter your First Name",
					minlength: "First Name must consist of at least 2 characters"
				},
				
				"donerLastName": {				
					required: "Please enter your Last Name",
					minlength: "Last Name must consist of at least 2 characters"
				},
				"dateOfBirth" : "Please enter your Date of Birth",				
				"preferredPhone" : "Please enter your Phone Number",			
				"zipcode" : {
					required: "Please enter Postal Code",
					number: "Please enter numbers only",
					minlength: "Postal Code must consist of at least 5 characters"
				},
				"addressLine1" : "Please enter address line 1",			
				"city" : "Please enter yout City",
				"state" : "Please enter your State",
				agree: "Please accept our policy",
				"companyName": "Please enter your Company Name",
				"companyAddress" : "Please enter your Company Address",
				"companyPhone" : {
					required: "Please enter Company Phone",
					//number: "Please enter numbers only",
					minlength: "Phone must consist of at least 4 characters"
				},
				"employeeEmailId" :  {					
					email : "Please enter valid email address"
				}
				<c:if test="${!pageContext.request.userPrincipal.isAuthenticated()}">
					,"email" :  {
						required: "Please enter your Email address",
						email : "Please enter valid email address",
						remote: "This email is associated with another contact. Please enter the correct first name, last name and date of birth or enter a different email"
					}
				</c:if>
				<c:if test="${pageContext.request.userPrincipal.isAuthenticated()}">
				,"email" :  {
					required: "Please enter your Email address",
					email : "Please enter valid email address"
				}
			</c:if>
				
			}
		});	
		
		var paymentFreq = $("#paymentInfoRadio").data("kendoDropDownList");
		/* $("#paymentFrequencySelect").on('change',function(e){   	
		    	if(paymentFreq.text() == 'Annual'){
		    		
		    	}
		 } */		 
		if($("#paymentInfoRadio").val()=='New'){
			$('#addBank').hide();	
			$('#addcard').show();				
		}else if($("#paymentInfoRadio").val()=='NewBank'){
			$('#addcard').hide();
			$('#addBank').show();						
		} else{
			$('#addcard').hide();
			$('#addBank').hide();				
		}	
		 <c:if test="${!pageContext.request.userPrincipal.isAuthenticated()}">
		 	$('#addcard').show();
		 </c:if>
		 $('body').on( "change", "#employerMatchingSelect", function() {
			 if(employerMatchingSelect.text() == '--Select Employee--'){
			    	$("#donationEmpMatchErr").css("display", "");
		    		$("#donationEmpMatchErr").text("Please select the Employee");	
			    }else{
			    	$("#donationEmpMatchErr").css("display", "none");
		    		$("#donationEmpMatchErr").text("");
		    		var employerMatchSelect = $("#employerMatchingSelect").val();
		    		var employerMatchSelectArr;
		    		if(employerMatchSelect){
		    			employerMatchSelectArr = employerMatchSelect.split("__");
		    			var amount = 0;
		    			var noOfInstallment;
		    			var paymentMode;
		    			var signupId;
		    			
		    			try {
		    				if(employerMatchSelectArr && employerMatchSelectArr[3] && parseFloat(employerMatchSelectArr[3]) > 0 ){
			    				amount = employerMatchSelectArr[3];
			    			}
			    			if(employerMatchSelectArr && employerMatchSelectArr[1] && parseFloat(employerMatchSelectArr[1]) > 0 ){
			    				noOfInstallment = employerMatchSelectArr[1];
			    			}
			    			if(employerMatchSelectArr && employerMatchSelectArr[0]){
			    				signupId = employerMatchSelectArr[0];
			    				$("#employeeSignUpId").attr("value", signupId);
			    			}
			    			if(employerMatchSelectArr && employerMatchSelectArr[2]){			    				
			    				paymentMode = employerMatchSelectArr[2];
			    			}
			    			if(employerMatchSelectArr && employerMatchSelectArr[4]){
			    				$("#employeeNameId").attr("value", employerMatchSelectArr[4]);
			    			}
			    			
			    			var billingFrequency = $("#billingFrequency").data("kendoDropDownList");
			    			billingFrequency.search(paymentMode);
			    			var numberOfInstallments = $("#numberOfInstallments").data("kendoDropDownList");
			    			numberOfInstallments.search(noOfInstallment);
			    			
			    			if( amount > 0 ){
			    				if(noOfInstallment >1 ){
			    					$("#donationAmtOtherTxt").attr("value", (amount/noOfInstallment).toFixed(0));
			    					$("#donationAmtStr").attr("value", (amount/noOfInstallment).toFixed(0));
			    					$("#donationAmtOther").attr('checked', 'checked');
			    				}else{
			    					$("#donationAmtOtherTxt").attr("value", amount);
			    				}
			    			}else{
			    				$("#donationAmtOtherTxt").attr("value", "");
			    			}
		    			}
		    			catch(err) {
		    				console.log(err);
		    			}		    			
		    			
		    		}		    		
			    }
				if(employerMatchingSelect.text()=='Other'){
					$("#employerMatchInfoDiv").css("display", "");
				}else{
					$("#employerMatchInfoDiv").css("display", "none");
				}
				$("#empMatchDetailsSpan").css("display","");
		 });
		 
		$('body').on( "change", "#paymentInfoRadio", function() {			
			if($("#paymentInfoRadio").val()=='New'){
				$('#addBank').hide();	
				$('#addcard').show();							
			}else if($("#paymentInfoRadio").val()=='NewBank'){
				$('#addcard').hide();
				$('#addBank').show();							
			} else{
				$('#addcard').hide();
				$('#addBank').hide();					
			}
		});
		
		$('input[name=recognizeAsRadioInput]').change(function () {	
			//alert($(this).val());
			var recognizedAsTxt = $(this).parent().find(".recognizedAsSpanCls").text();
			$("#recognizedAsHidInput").attr("value", recognizedAsTxt);
			$("#donationContactSelErr").css("display", "none");
    		$("#donationContactSelErr").text("");				
	    });
		
		/* var fName = $(document).find("#donerFirstName").val();
		var lName = $(document).find("#donerLastName").val();
		if(fName && lName){
			$("#recognizedAsSpan").css("display", "");
			$(document).find("#recognisedAsFName").html(fName);
			$(document).find("#recognisedAsLName").html(lName);		
			///$("#recognizedAsName").attr("value", fName + " " +lName);			  				
			$("#fullName").attr("value", fName + " " + lName);
		}else{
			$("#recognizedAsSpan").css("display", "none");
			$(document).find("#recognisedAsFName").html("");
			$(document).find("#recognisedAsLName").html("");
			//$("#recognizedAsName").attr("value", "");
			$("#fullName").attr("value", "");
		}
		
		$(document).find("#donerFirstName, #donerLastName").on('blur mouseup',function(){
			var fName = $(document).find("#donerFirstName").val();
			var lName = $(document).find("#donerLastName").val();
			if(fName && lName){
				$("#recognizedAsSpan").css("display", "");
				$(document).find("#recognisedAsFName").html(fName);
				$(document).find("#recognisedAsLName").html(lName);		
				//$("#recognizedAsName").attr("value", fName + " " +lName);
				$("#fullName").attr("value", fName + " " + lName);
			}else{
				$("#recognizedAsSpan").css("display", "none");
				$(document).find("#recognisedAsFName").html("");
				$(document).find("#recognisedAsLName").html("");
				//$("#recognizedAsName").attr("value", "");
				$("#fullName").attr("value", "");
			}
		}); */
		
		
		$('#donationBranch').kendoDropDownList();
		var donationBranch = $("#donationBranch").data("kendoDropDownList");
		//donationBranch.select(0);
		$("#donationBranch").on('change',function(e){    	
			 var donationBranchText = $("#donationBranch").val();
		     if(donationBranchText && donationBranchText == 'Other'){
		    	 $("#YmcaBranchTxt").css("display", "");		    	 
		     }else{
		    	 $("#YmcaBranchTxt").css("display", "none");
		     }
		});
		var today = kendo.date.today();
	    var dateToday = new Date();  
	    
		$("#donationDate").kendoDatePicker({
			format: "MM/dd/yyyy",
			value: today,
			min: dateToday			
		});  
		$("#todayKendoDate").kendoDatePicker({
			format: "MM/dd/yyyy",
			value: today,
			min: dateToday			
		});
		$('#paymentInfoRadio').kendoDropDownList();	
		/* var donationFrequencyMonthsSel = $("#donationFrequencyMonthsSel").data("kendoDropDownList");
		$("#donationFrequencyMonthsSel").closest(".k-widget").hide();
		$(".donationFrequencyStr").on('change',function(e){
			$("#donationFreqErr").css("display", "none");
    		$("#donationFreqErr").text("");
			var donationFreqVal = $(this).val();
			if(donationFreqVal == "One Time"){
				$("#donationFrequencyMonthsSel").closest(".k-widget").hide();	
				donationFrequencyMonthsSel.select(0);
				$("#donationFreqMonthlySelMsgSpan").css("display", "none");
			}
			if(donationFreqVal == "Monthly"){
				$("#donationFrequencyMonthsSel").closest(".k-widget").show();
				$("#donationFreqMonthlySelMsgSpan").css("display", "");
				donationFrequencyMonthsSel.search("Continuous");
			}
		}); */
		
		$('#contactLstSelect').kendoDropDownList();
		
		var contactLst = $("#contactLstSelect").data("kendoDropDownList");
		
		/* $("#donationFrequencyMonthsSel").on('change',function(e){    	
			 var donationFrequency = donationFrequencyMonthsSel.text();
		     if(donationFrequency && donationFrequency == '--Select No of Months--'){
		    	 $("#donationFreqErr").css("display", "");
		    	 $("#donationFreqErr").text("Please select the number of Months");
		    	 $("#amtPledgingNoteSpan").html("");
		     }else{
		    	 $("#donationFreqErr").css("display", "none");
		    	 $("#donationFreqErr").text("");
		    	 var donationAmt = $("#donationAmtStr").val();
		    	 if(donationAmt && donationFrequency && donationAmt != 0 && donationFrequency != "Continuous"){
		    		 var amount = parseFloat(donationAmt);
		    		 var frequency = parseFloat(donationFrequency);
		    		 $("#amtPledgingNoteSpan").html("iii) You are pledging $"+ amount * frequency);	
		    	 }
		    	 	    	 
		     }
		}); */

		 $("#contactLstSelect").on('change',function(e){    	
				var selectedContact = contactLst.text();
			    if(selectedContact && selectedContact == 'Other'){		    	
					$("#recognizeAsOtherTxt").css("display", "inline");						
			    }else{
			    	$("#recognizeAsOtherTxt").css("display", "none");
			    	$("#recognizedAsHidInput").attr("value",  $("#contactLstSelect").val());
			    }
		    	var fName = $(document).find("#donerFirstName").val();
				var lName = $(document).find("#donerLastName").val();
				//$(document).find("#recognisedAsFName").html(fName);
				//$(document).find("#recognisedAsLName").html(lName);	
				$("#recognizedAsContactName").attr("value",  $("#contactLstSelect").val());						
				$("#donationContactSelErr").css("display", "none");
	    		$("#donationContactSelErr").text("");
		 });
		 
		 $('#contry').kendoDropDownList();
		 $('#state').kendoDropDownList();
		
		/* var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
		var eventer = window[eventMethod];
		var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
		eventer(messageEvent,function(e) {
			var key = e.message ? "message" : "data";
			var data = e[key];
			$("#contentFormDiv").css("display", "none");			
			if(data.view.toString() == "Success"){
				$("#paymentSuccessDiv").css("display", "block");
			}
			if(data.view.toString() == "Failure"){
				$("#paymentFailuresDiv").css("display", "block");
			}
			//$("#form_container").html("Success Redirection " + data.view);			
		},false); */
				
		//$("#jp_request_hash").val(hash.toString());
		//$("#order_number").val(paymentOrderId.toString());
		
		var currentYear = new Date().getFullYear();
		currentYear = parseInt(currentYear.toString().substring(2, 4));
		for(var i=0; i<30 ; i++){
			$('#createDonationExpYr').append($('<option>', {value: currentYear,text: currentYear}));
			currentYear = currentYear +1;
		}
		
		$('input[name=finalAmountRadio]').change(function () {			
			if($(this).val() == 'Other'){
				$("#donationAmtStr").attr("value", $("#donationAmtOtherTxt").val());				
    		}else{
    			$("#donationAmtStr").attr("value", $(this).val());	    		
    		}		
	        //alert($(this).val()); 
	        //$("#donationAmtStr").attr("value", $(this).val());	
	        $("#donationAmtErr").css("display", "none");
			$("#donationAmtErr").text("");			
			if($(this).val() == 'Other' && $("#donationAmtOtherTxt").html().trim() == ''){
				$("#amtChanrgedNoteSpan").html("");
				$("#donationAmtErr").css("display", "");
				$("#donationAmtErr").text("Please enter the donation amount");
			}else if($(this).val() == 'Other'){
				$("#amtChanrgedNoteSpan").html("ii) You will be charged $" + $("#donationAmtOtherTxt").html() +" per month");
			}else{
				$("#amtChanrgedNoteSpan").html("ii) You will be charged $" + $(this).val() +" per month");
				//$("#donationAmtOtherTxt").attr("value", "");
			}			
			var donationAmt = $("#donationAmtStr").val();
			/* var donationFrequency = donationFrequencyMonthsSel.text();
			if(donationAmt && donationFrequency && donationAmt != 0 && donationFrequency != "Continuous"){
				try{
					var amount = parseFloat(donationAmt);
					var frequency = parseFloat(donationFrequency);
					if(amount && frequency && amount != "NaN" && frequency != "NaN"){
						$("#amtPledgingNoteSpan").html("iii) You are pledging $"+ amount * frequency);
					}					
				}catch(err){
					$("#amtPledgingNoteSpan").html("Please enter correct amount" + err.message);
				}
				 	
			} */
	    });
		
		$('input[name=donationFrequencyStr]').change(function () {
	        //alert($(this).val());
	        $("#donationFreq").attr("value", $(this).val());
	    });
		
		$('input[name=cardTypeStr]').change(function () {
	        //alert($(this).val());
	        $("#cardType").attr("value", $(this).val());
	    });
		/* $( "#createDonationButton" ).click(function(){	
			$(".k-loading-mask").show();
			$(".k-loading-text").html("Please wait while the Donation Information created...");			
			$.ajax({
				  type: "POST",
				  url: $('#createDonationForm').attr( "action"),
				  data: $('#createDonationForm').serialize(),
				  success: function( data ) {				  	  
				  	  if(data=='SUCCESS'){
					  	  $("#addDonationErrorSpan").css("display", "none");		
						  $("#addDonationErrorSpan" ).html("");	
						  setTimeout(function(){$(".k-loading-text").fadeOut("slow");}, 4000);
						  setTimeout(function(){$(".k-loading-text").html("Donation Information Added successfully");$(".k-loading-text").fadeIn("slow");}, 5000);
					  	  setTimeout(function(){$(".k-loading-text").fadeOut("slow");}, 6900);
					  	  
					  	  $("#addDonationSuccessSpan").css("display", "block");		
						  $("#addDonationSuccessSpan" ).html("Donation Information Added successfully");
					  	  
					  	  //setTimeout(function(){location.reload();}, 7000);
					  	  
				  	  }else if(data == 'NOT_FOUND'){
				  		  $("#addDonationSuccessSpan").css("display", "none");		
						  $("#addDonationSuccessSpan" ).html("");	
						  $("#addDonationErrorSpan").css("display", "block");		
						  $( "#addDonationErrorSpan" ).html("Customer Information Not Found.");
						  $(".k-loading-mask").hide();
				  	  }else {
				  		  $("#addDonationSuccessSpan").css("display", "none");		
						  $("#addDonationSuccessSpan" ).html("");	
						  $("#addDonationErrorSpan").css("display", "block");		
						  $( "#addDonationErrorSpan" ).html("There was some error. Please try again later");
						  $(".k-loading-mask").hide();
				  	  }					  
				  },
				  error: function( xhr,status,error ){
					  $("#addDonationSuccessSpan").css("display", "none");		
					  $("#addDonationSuccessSpan" ).html("");	
					  $("#addDonationErrorSpan").css("display", "block");		
					  $( "#addDonationErrorSpan" ).html("There was some error. Please try again later");
					  $(".k-loading-mask").hide();
				  }
			});
			
		}); */	
		
		
		$("#createDonationButton").click(function(){
			console.log("createDonationButton click");
			 var jsonData = {
					name : $("#nameOnCard").val(),
					cardNum : $("#cardNumber").val(),
					cscNumber : $("#cscNumber").val(),
					AddressLine1 : $("#AddressLine1").val(),
					AddressLine2 : $("#AddressLine2").val(),
					City : $("#City").val(),
					state : $("#state").val(),
					zipcode : $("#zipcode").val(),
					email : $("#email").val(),
					amount : $("#donationAmtOtherTxt").val(),
					expMonth : $("#expMonth").val(),
					expYr : $("#createDonationExpYr").val(),
					contry : $("#contry").val()
					
			 };
			 //console.log(jsonData);
			 var win = document.getElementById("childIframeId").contentWindow;
			 //win.postMessage(jsonData, '*');
			 if(!$("#createDonationForm").valid()) {
	    		console.log("Validation failed");
	    	} else if(!$(document).find( "input:radio[name=finalAmountRadio]" ).is(":checked")){	    		
	    		$("#donationAmtErr").css("display", "");
	    		$("#donationAmtErr").text("Please select the Donation Amount");	    		
	    	} /* else if(!$(document).find( "input:radio[name=signUpPricingOption]" ).is(":checked")){	    		
	    		$("#donationFreqErr").css("display", "");
	    		$("#donationFreqErr").text("Please select the Donation Frequency");	    		
	    	} else if($("input:checkbox[name=employerMatching]" ).is(":checked") && employerMatchingSelect.text() == '--Select Employer--'){	    		
	    		$("#donationEmpMatchErr").css("display", "");
	    		$("#donationEmpMatchErr").text("Please select the Employee");	    		
	    	} else if(!$(document).find( "input:radio[name=recognizeAsRadioInput]" ).is(":checked")){	
	    		$("#donationContactSelErr").css("display", "");
	    		$("#donationContactSelErr").text("Please select Recognized As option");
	    	}  */else {	  
	    		/* if($('input:radio[name=finalAmountRadio]:checked').val() == 'Other' && $("#donationAmtOtherTxt").val() == ''){
	    			$("#donationAmtErr").css("display", "");
		    		$("#donationAmtErr").text("Please enter the Donation Amount");
	    		}else  */
	    		var amountVal = $('input[name=finalAmountRadio]:checked').val();	    		
	    		var donationAmtTxt = $("#donationAmtOtherTxt").val().trim();
	    		if(amountVal == 'Other' && donationAmtTxt == ''){
	    			$("#donationAmtErr").css("display", "");
		    		$("#donationAmtErr").text("Please enter the Donation Amount");
	    		}else if($('input:radio[name=signUpPricingOption]:checked').val() == 'Monthly' && donationFrequencyMonthsSel.text() == '--Select No of Months--'){	    			
	    			$("#donationFreqErr").css("display", "");
		    		$("#donationFreqErr").text("Please select the number of Months");
	    		} else if($('#recognizedAsContactName').is(':checked') && contactLst.text() == '--Select Contact--'){
	    			$("#donationContactSelErr").css("display", "");
		    		$("#donationContactSelErr").text("Please select the contact");
	    		} else if($('#recognizedAsContactName').is(':checked') && contactLst.text() == 'Other' && $("#recognizeAsOtherTxt").val().trim() == ""){
	    			$("#donationContactSelErr").css("display", "");
		    		$("#donationContactSelErr").text("Please enter contact name");
	    		} 
	    		<c:if test="${donationTAndC != null && donationTAndC.waiversAndTC != null && not empty donationTAndC.waiversAndTC.tcDescription}">
		    		else if(!$("input[name='chkTermsAndCondition']:checked").val()){ 
		    			
		    			var kendoWindow = $("<div />").kendoWindow({
		    				title: "Error",
		    				resizable: false,
		    				modal: true,
		    				width:400
		    			});
	
		    			kendoWindow.data("kendoWindow")
		    			 .content($("#terms-conditions-ErrorBox").html())
		    			 .center().open();
	
		    			kendoWindow
		    			.find(".confirm-terms-conditions")
		    			.click(function() {
		    				if ($(this).hasClass("confirm-terms-conditions")) {         		
		    					kendoWindow.data("kendoWindow").close();
		    				}
		    			})
		    			.end();
		    		}
	    		</c:if>
		    	else{
	    			// alert(contactLst.text());
	    			if($('#recognizedAsContactName').is(':checked') && contactLst.text() == 'Other'){
	    				$("#recognizedAsHidInput").attr("value",  $("#recognizeAsOtherTxt").val());	    				
		    		}  
	    			if($('input:radio[name=signUpPricingOption]:checked').val() == 'One Time'){	    			
	    				donationFrequencyMonthsSel.select(1);
		    		}
	    			console.log("Valication Success");
	    			processJetPayPayment();
	    			//document.forms["createDonationForm"].submit();
	    		}
	    		
	    	}
		});		
		/* $("#donationAmtOtherTxt").on('blur mouseup',function(){
			//alert($("#donationAmtOtherTxt").text());
			if($('input:radio[name=finalAmountRadio]:checked').val() == 'Other' && $("#donationAmtOtherTxt").html().trim() == ''){
    			$("#donationAmtErr").css("display", "");
	    		$("#donationAmtErr").text("Please enter the Donation Amount");
    		}else{
    			$("#donationAmtErr").css("display", "none");
	    		$("#donationAmtErr").text("");
    		}			
		});	 */	
		
		/* $(document).on('change', 'input:[name=donationAmtString]', function(){
			$("#donationAmtErr").css("display", "none");
			$("#donationAmtErr").text("");	
		}); */
	});
	
	function isNumberKey(evt) {
       var charCode = (evt.which) ? evt.which : evt.keyCode;
       if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)){
    	   if($("#donationAmtOtherTxt").val().trim() == ''){
   				$("#donationAmtErr").css("display", "");
	    		$("#donationAmtErr").text("Please enter the Numbers only");
	   		}
    	   return false;    	   
    	}else{
    		$("#donationAmtErr").css("display", "none");
			$("#donationAmtErr").text("");
			$("#donationAmtStr").attr("value", $("#donationAmtOtherTxt").val());
			return true;
    	}
          
       
    }
	
	function contactNameChange(evt) {
		if($('#recognizedAsContactName').is(':checked') && contactLst.text() == 'Other' && $("#recognizeAsOtherTxt").val().trim() == ""){
		
		}else {
			
		}	       
	}
	
	function processJetPayPayment(){
		$("#paymentOrderId").attr("value", "");
		$("#paymentMethodId").attr("value", "");
		console.log("payment" + $("#paymentInfoRadio").val());
		//var selectedPaymentMethod = $("#paymentInfoRadio").data("kendoDropDownList").text();
		if($("#paymentInfoRadio").val() && $("#paymentInfoRadio").val()!='New' && $("#paymentInfoRadio").val()!='NewBank' && $("#paymentInfoRadio").val()!='Cash' && $("#paymentInfoRadio").val()!='Check' && $("#paymentInfoRadio").val()!='None' && $("#paymentInfoRadio").val()!='Stock'){
			
			var paymentDDvalue = $('#paymentInfoRadio').val();
			var paymentDDValueSplit = paymentDDvalue.split("__");			
			var paymentMethodType = paymentDDValueSplit[0];
			var paymentMethodToken = paymentDDValueSplit[1];
			var paymentMethodId = paymentDDValueSplit[2];
			$("#paymentMethodId").attr("value", paymentMethodId);
			if (paymentMethodType && paymentMethodType == 'CREDIT') {	
				if(parseFloat($("#donationAmtStr").val()) > 0){
					$(".k-loading-mask").show();
					$(".k-loading-text").html("Please wait");
					$("#statusBlock-payment").css("display", "none");	
					$("#tcloginErrorSpan-payment").css("display", "none");	
					$( "#tcloginErrorSpan-payment" ).html("");
					$('#contentFormDiv').block({ 
						message: '<h1>Please wait..</h1>', 
						css: { border: '3px solid #a00' } 
					});
					
					$.ajax({
						  type: "POST",
						  url: "processPaymentByTokenId",	
						  data: { token: paymentMethodToken, totalAmount : $("#donationAmtStr").val()},
						  success: function( data ) {						  
							  var paymentMethodHtml = '';
							  if(data != null && data.responseText == "APPROVED"){							  
								  //$("#paymentTransId").attr("value", data.transId); 						  
									$("#statusBlock-payment").css("display", "none");	
									$("#tcloginErrorSpan-payment").css("display", "none");	
									$( "#tcloginErrorSpan-payment" ).html("");						  
								  document.forms["createDonationForm"].submit();						  
							  }else {							
								  $("#statusBlock-payment").css("display", "block");	
									$("#tcloginErrorSpan-payment").css("display", "block");	
									$( "#tcloginErrorSpan-payment" ).html("Error occurred while processing the payment. Please try again later <br />ActionCode :<b>"+data.actCode+"</b> Error message : "+data.responseText);
							  }
							  $(".k-loading-mask").hide();
							  $('#contentFormDiv').unblock(); 
						  },
						  error: function( xhr,status,error ){
							  $("#statusBlock-payment").css("display", "block");	
							  $("#tcloginErrorSpan-payment").css("display", "block");	
							  $( "#tcloginErrorSpan-payment" ).html("There was some error. Please try again later");	
							  $('#contentFormDiv').unblock();
						  }
					});
				}else{
					$("#statusBlock-payment").css("display", "block");	
					  $("#tcloginErrorSpan-payment").css("display", "block");	
					  $( "#tcloginErrorSpan-payment" ).html("Please enter the correct donation amount");	
					  $('#contentFormDiv').unblock();
				}
			}
		} else if(typeof $("#paymentInfoRadio").val() == "undefined" || $("#paymentInfoRadio").val()=='New'){
			$(".k-loading-mask").show();
			$(".k-loading-text").html("Please wait");
			$('#contentFormDiv').block({ 
				message: '<h1>Please wait..</h1>', 
				css: { border: '3px solid #a00' } 
			});
			//var merchantId = "YMCA07021001"; 
			var merchantId = "TESTTERMINAL";			
			var JetDirectToken	= "1234567890ABCDEFGHIJKabcdefghijk";
			var hash = '';
			var paymentAmount = $("#donationAmtStr").val() + ".00";
			paymentOrderId = Math.floor((Math.random()*1000000000000)+1);
			$("#paymentOrderId").attr("value", paymentOrderId);
			var jsSha = new jsSHA(merchantId+paymentAmount+JetDirectToken+paymentOrderId);
			hash = jsSha.getHash("SHA-512", "HEX");		
			if(parseFloat(paymentAmount) > 0){
				var saveCard = 'N';
				if($('.SaveCard').is(":checked")){
					saveCard = 'Y';
				}
				var jsonData = {
						trans_type : "SALE", // "TOKENIZE" // "AUTHONLY", "SALE"
						ud1 : $("#loggedInAccountId").val(),
						ud2 : $("#nickName").val(),
						name : $("#fullName").val(),
						cardNum : $("#cardNum").val(),
						cscNumber : $("#securityCode").val(),
						expMonth : $("#addCardExpirationMonthSelect").val(),
						expYr : $("#addCardExpirationYearSelect").val(),
						amount : paymentAmount,
						AddressLine1 : $("#billingAddressLine1").val(),
						AddressLine2 : $("#billingAddressLine2").val(),
						City : $("#billingCity").val(),
						state : $("#billingState").val(),
						zipcode : $("#billingZip").val(),
						email : "test@gmail.com",
						contry : "US",
						jetPayHash : hash.toString(),
						paymentOrderId : paymentOrderId.toString(),
						isSaveCard : saveCard
					};
					var win = document.getElementById("childIframeId").contentWindow;
					win.postMessage(jsonData, '*');
			}else{
				$("#statusBlock-payment").css("display", "block");	
					  $("#tcloginErrorSpan-payment").css("display", "block");	
					  $( "#tcloginErrorSpan-payment" ).html("Please enter the correct donation amount");				
			}	
			$(".k-loading-mask").hide();
		}else {
			document.forms["createDonationForm"].submit();
		}
		$(".k-loading-mask").hide();
	}
</script>

</body>